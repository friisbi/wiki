{% extends "templates/wiki/layout.html" %}
{% from "templates/wiki/macros/buttons.html" import ghost_button, render_icon %}

{% block title %}
    {{ doc.title }}
{% endblock %}

{% block body %}
<article x-data="wikiDocument()" class="max-w-4xl mx-auto">
    <!-- Page Header -->
    <header class="mb-8 pb-4 border-b border-[var(--outline-gray-1)]">
        <h1 class="text-3xl font-bold text-[var(--ink-gray-9)] mb-4">{{ doc.title }}</h1>

        <!-- Action Buttons -->
        <div class="flex items-center gap-3">
            <!-- Copy Markdown Button -->
            <button @click="copyMarkdown()"
                    class="inline-flex items-center gap-2 px-3 py-1.5 text-sm font-medium text-[var(--ink-gray-5)] hover:text-[var(--ink-gray-9)] hover:bg-[var(--surface-gray-2)] rounded-md transition-colors duration-200 cursor-pointer">
                <template x-if="!copied">
                    {{ render_icon("clipboard") }}
                </template>
                <template x-if="copied">
                    {{ render_icon("check", "text-[var(--ink-green-2)]") }}
                </template>
                <span x-text="copied ? 'Copied!' : 'Copy Markdown'"></span>
            </button>

            <!-- Edit Page Link -->
            {{ ghost_button(text="Edit Page", icon="edit", href="/edit-wiki-page/" ~ doc.name) }}
        </div>
    </header>

    <!-- Page Content -->
    <div class="prose prose-lg max-w-none">
        {{ rendered_content }}
    </div>
</article>

<script>
    function wikiDocument() {
        return {
            copied: false,
            markdown: {{ raw_markdown | tojson }},

            copyMarkdown() {
                navigator.clipboard.writeText(this.markdown).then(() => {
                    this.copied = true;
                    setTimeout(() => {
                        this.copied = false;
                    }, 2000);
                }).catch(err => {
                    console.error('Failed to copy markdown:', err);
                });
            }
        }
    }
</script>
{% endblock %}