<!-- Table of Contents (Right Sidebar) -->
<aside class="hidden xl:block fixed right-6 top-[77px] w-56">
    <nav class="max-h-[calc(100vh-8rem)] overflow-y-auto no-scrollbar">
        <template x-if="headings.length > 0">
            <div>
                <h3 class="text-sm font-semibold text-[var(--ink-gray-9)] mb-3">On this page</h3>
                <ul class="space-y-2">
                    <template x-for="heading in headings" :key="heading.id">
                        <li>
                            <a :href="'#' + heading.id"
                               @click.prevent="scrollToHeading(heading.id)"
                               :class="activeId === heading.id
                                   ? 'text-[var(--ink-gray-9)] font-medium'
                                   : 'text-[var(--ink-gray-5)] hover:text-[var(--ink-gray-9)]'"
                               :style="`padding-left: ${(heading.level - 2) * 0.75}rem`"
                               class="block text-sm transition-colors duration-200"
                               x-text="heading.text">
                            </a>
                        </li>
                    </template>
                </ul>
            </div>
        </template>
    </nav>

    {% if wiki_space and wiki_space.enable_feedback_collection %}
    {% include "templates/wiki/includes/feedback_widget.html" %}
    {% endif %}
</aside>

<script>
    // Initialize TOC store for external refresh capability
    document.addEventListener('alpine:init', () => {
        Alpine.store('toc', {
            refreshCallback: null,

            setRefreshCallback(callback) {
                this.refreshCallback = callback;
            },

            refresh() {
                if (this.refreshCallback) {
                    this.refreshCallback();
                }
            }
        });
    });
</script>
